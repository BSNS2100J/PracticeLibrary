<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Viewer - ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .test-suite {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
        }

        .test-section h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .test-case {
            margin-bottom: 12px;
            padding: 12px 15px;
            background: #f5f5f5;
            border-left: 4px solid #ddd;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .test-case.pass {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .test-case.fail {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .test-case-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .test-case-message {
            font-size: 12px;
            color: #555;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .test-case.pass .test-case-message {
            color: #155724;
        }

        .test-case.fail .test-case-message {
            color: #721c24;
        }

        .test-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-item-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-item-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .pass-rate {
            font-size: 20px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .test-controls {
            text-align: center;
            padding: 20px 30px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª CSV Viewer ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</h1>
            <p>å›³æ›¸ç®¡ç†CSVãƒ“ãƒ¥ãƒ¼ã‚¢ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ</p>
        </header>

        <div class="test-controls">
            <button onclick="runAllTests()">ğŸš€ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
        </div>

        <div class="test-suite" id="test-suite"></div>

        <div class="test-summary" id="test-summary" style="display: none;">
            <div class="summary-item">
                <div class="summary-item-value" id="total-tests">0</div>
                <div class="summary-item-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
            </div>
            <div class="summary-item">
                <div class="summary-item-value" style="color: #28a745;" id="passed-tests">0</div>
                <div class="summary-item-label">æˆåŠŸ</div>
            </div>
            <div class="summary-item">
                <div class="summary-item-value" style="color: #dc3545;" id="failed-tests">0</div>
                <div class="summary-item-label">å¤±æ•—</div>
            </div>
            <div class="summary-item">
                <div class="summary-item-value pass-rate" id="pass-rate">0%</div>
                <div class="summary-item-label">æˆåŠŸç‡</div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        class TestRunner {
            constructor() {
                this.tests = [];
                this.results = [];
            }

            test(sectionName, testName, testFunction) {
                this.tests.push({
                    section: sectionName,
                    name: testName,
                    fn: testFunction
                });
            }

            assert(condition, message) {
                if (!condition) {
                    throw new Error(message);
                }
            }

            assertEqual(actual, expected, message) {
                if (actual !== expected) {
                    throw new Error(`${message} (Expected: ${expected}, Got: ${actual})`);
                }
            }

            assertTrue(condition, message) {
                if (!condition) {
                    throw new Error(message);
                }
            }

            async run() {
                this.results = [];
                
                for (const test of this.tests) {
                    try {
                        await test.fn();
                        this.results.push({
                            section: test.section,
                            name: test.name,
                            passed: true,
                            message: 'âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ'
                        });
                    } catch (error) {
                        this.results.push({
                            section: test.section,
                            name: test.name,
                            passed: false,
                            message: `âŒ ${error.message}`
                        });
                    }
                }

                this.display();
            }

            display() {
                const suiteContainer = document.getElementById('test-suite');
                suiteContainer.innerHTML = '';

                const sections = new Map();
                
                for (const result of this.results) {
                    if (!sections.has(result.section)) {
                        sections.set(result.section, []);
                    }
                    sections.get(result.section).push(result);
                }

                for (const [sectionName, tests] of sections) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'test-section';

                    const title = document.createElement('h2');
                    title.textContent = sectionName;
                    sectionDiv.appendChild(title);

                    for (const test of tests) {
                        const testDiv = document.createElement('div');
                        testDiv.className = `test-case ${test.passed ? 'pass' : 'fail'}`;

                        const testTitle = document.createElement('div');
                        testTitle.className = 'test-case-title';
                        testTitle.textContent = test.name;

                        const testMessage = document.createElement('div');
                        testMessage.className = 'test-case-message';
                        testMessage.textContent = test.message;

                        testDiv.appendChild(testTitle);
                        testDiv.appendChild(testMessage);
                        sectionDiv.appendChild(testDiv);
                    }

                    suiteContainer.appendChild(sectionDiv);
                }

                this.displaySummary();
            }

            displaySummary() {
                const totalTests = this.results.length;
                const passedTests = this.results.filter(r => r.passed).length;
                const failedTests = totalTests - passedTests;
                const passRate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;

                document.getElementById('total-tests').textContent = totalTests;
                document.getElementById('passed-tests').textContent = passedTests;
                document.getElementById('failed-tests').textContent = failedTests;
                document.getElementById('pass-rate').textContent = passRate + '%';
                document.getElementById('test-summary').style.display = 'flex';
            }
        }

        // ãƒ†ã‚¹ãƒˆå®šç¾©
        const runner = new TestRunner();

        // ==================== CSVãƒ‘ãƒ¼ã‚¹é–¢é€£ãƒ†ã‚¹ãƒˆ ====================
        runner.test('CSVãƒ‘ãƒ¼ã‚¹æ©Ÿèƒ½', 'æ­£å¸¸ãªCSVãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    runner.assertTrue(results.data.length === 2, 'ãƒ‡ãƒ¼ã‚¿è¡ŒãŒ2è¡Œã§ã‚ã‚‹');
                    runner.assertTrue(Object.keys(results.data[0]).length === 4, 'ã‚«ãƒ©ãƒ æ•°ãŒ4ã§ã‚ã‚‹');
                    runner.assertEqual(results.data[0]['ã‚¿ã‚¤ãƒˆãƒ«'], 'ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®', 'ã‚¿ã‚¤ãƒˆãƒ«åˆ—ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹');
                    runner.assertEqual(results.data[0]['è‘—è€…'], 'æ‘ä¸Šæ˜¥æ¨¹', 'è‘—è€…åˆ—ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹');
                    runner.assertEqual(results.data[0]['ç™ºè¡Œå¹´'], '1987', 'ç™ºè¡Œå¹´åˆ—ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹');
                    runner.assertEqual(results.data[0]['ISBNã‚³ãƒ¼ãƒ‰'], '978-4-06-182009-8', 'ISBNã‚³ãƒ¼ãƒ‰åˆ—ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹');
                }
            });
        });

        runner.test('CSVãƒ‘ãƒ¼ã‚¹æ©Ÿèƒ½', 'ç©ºè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãƒ†ã‚¹ãƒˆ', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8

1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    runner.assertTrue(results.data.length === 2, 'ç©ºè¡ŒãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¦2è¡Œã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã‚‹');
                }
            });
        });

        runner.test('CSVãƒ‘ãƒ¼ã‚¹æ©Ÿèƒ½', 'ç©ºã®CSVãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰`;

            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    runner.assertTrue(results.data.length === 0, 'ç©ºã®ãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã¦ã„ã‚‹');
                }
            });
        });

        // ==================== ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼ãƒ†ã‚¹ãƒˆ ====================
        runner.test('ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼', 'ã™ã¹ã¦ã®å¿…é ˆã‚«ãƒ©ãƒ ãŒå­˜åœ¨', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    const requiredColumns = ['ã‚¿ã‚¤ãƒˆãƒ«', 'è‘—è€…', 'ç™ºè¡Œå¹´', 'ISBNã‚³ãƒ¼ãƒ‰'];
                    const headers = Object.keys(results.data[0]);
                    
                    for (const col of requiredColumns) {
                        runner.assertTrue(headers.includes(col), `ã‚«ãƒ©ãƒ  "${col}" ãŒå­˜åœ¨ã™ã‚‹`);
                    }
                }
            });
        });

        runner.test('ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼', 'ã‚«ãƒ©ãƒ æ•°ãŒ4åˆ—ã§ã‚ã‚‹', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    const columnCount = Object.keys(results.data[0]).length;
                    runner.assertEqual(columnCount, 4, 'ã‚«ãƒ©ãƒ æ•°ãŒæ­£ç¢ºã«4ã§ã‚ã‚‹');
                }
            });
        });

        // ==================== ãƒ‡ãƒ¼ã‚¿å†…å®¹æ¤œè¨¼ãƒ†ã‚¹ãƒˆ ====================
        runner.test('ãƒ‡ãƒ¼ã‚¿å†…å®¹æ¤œè¨¼', 'ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºç™½ã§ãªã„', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    for (const row of results.data) {
                        runner.assertTrue(row['ã‚¿ã‚¤ãƒˆãƒ«'] && row['ã‚¿ã‚¤ãƒˆãƒ«'].trim() !== '', 'ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºç™½ã§ãªã„');
                    }
                }
            });
        });

        runner.test('ãƒ‡ãƒ¼ã‚¿å†…å®¹æ¤œè¨¼', 'è‘—è€…ãŒç©ºç™½ã§ãªã„', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    for (const row of results.data) {
                        runner.assertTrue(row['è‘—è€…'] && row['è‘—è€…'].trim() !== '', 'è‘—è€…ãŒç©ºç™½ã§ãªã„');
                    }
                }
            });
        });

        runner.test('ãƒ‡ãƒ¼ã‚¿å†…å®¹æ¤œè¨¼', 'ç™ºè¡Œå¹´ãŒ4æ¡ã®æ•°å€¤', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    for (const row of results.data) {
                        const year = row['ç™ºè¡Œå¹´'];
                        runner.assertTrue(/^\d{4}$/.test(year), `ç™ºè¡Œå¹´ "${year}" ãŒ4æ¡ã®æ•°å€¤ã§ã‚ã‚‹`);
                    }
                }
            });
        });

        runner.test('ãƒ‡ãƒ¼ã‚¿å†…å®¹æ¤œè¨¼', 'ISBNã‚³ãƒ¼ãƒ‰ãŒç©ºç™½ã§ãªã„', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    for (const row of results.data) {
                        runner.assertTrue(row['ISBNã‚³ãƒ¼ãƒ‰'] && row['ISBNã‚³ãƒ¼ãƒ‰'].trim() !== '', 'ISBNã‚³ãƒ¼ãƒ‰ãŒç©ºç™½ã§ãªã„');
                    }
                }
            });
        });

        // ==================== ISBNå½¢å¼æ¤œè¨¼ãƒ†ã‚¹ãƒˆ ====================
        runner.test('ISBNå½¢å¼æ¤œè¨¼', 'æœ‰åŠ¹ãªISBN-13å½¢å¼ï¼ˆãƒã‚¤ãƒ•ãƒ³åŒºåˆ‡ã‚Šï¼‰', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    const isbn = results.data[0]['ISBNã‚³ãƒ¼ãƒ‰'];
                    // ISBN-13ã®å½¢å¼: 978-X-XX-XXXXXX-X ã¾ãŸã¯ 979-X-XX-XXXXXX-X
                    runner.assertTrue(/^(978|979)-\d{1}-\d{2}-\d{6,7}-\d$/.test(isbn), `ISBNã‚³ãƒ¼ãƒ‰ "${isbn}" ãŒæœ‰åŠ¹ãªå½¢å¼ã§ã‚ã‚‹`);
                }
            });
        });

        runner.test('ISBNå½¢å¼æ¤œè¨¼', 'ISBNãŒæ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    for (const row of results.data) {
                        const isbn = row['ISBNã‚³ãƒ¼ãƒ‰'];
                        runner.assertTrue(/^[0-9\-]+$/.test(isbn), `ISBNã‚³ãƒ¼ãƒ‰ "${isbn}" ãŒæ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ã§ã‚ã‚‹`);
                    }
                }
            });
        });

        // ==================== ãƒ‡ãƒ¼ã‚¿é‡åˆ¶é™ãƒ†ã‚¹ãƒˆ ====================
        runner.test('ãƒ‡ãƒ¼ã‚¿é‡åˆ¶é™', 'æœ€å¤§è¡Œæ•°ï¼ˆ1000è¡Œï¼‰ä»¥ä¸‹', function() {
            // 1000è¡Œã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            let csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰\n`;
            for (let i = 1; i <= 1000; i++) {
                csvText += `ãƒ†ã‚¹ãƒˆæœ¬${i},è‘—è€…${i},${2000 + Math.floor(i / 100)},978-4-${String(i).padStart(2, '0')}-${String(i).padStart(6, '0')}-${i % 10}\n`;
            }

            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    runner.assertTrue(results.data.length <= 1000, 'ãƒ‡ãƒ¼ã‚¿è¡Œæ•°ãŒ1000ä»¥ä¸‹ã§ã‚ã‚‹');
                }
            });
        });

        runner.test('ãƒ‡ãƒ¼ã‚¿é‡åˆ¶é™', 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¨ˆç®—é–¢æ•°', function() {
            // formatFileSizeã®ãƒ†ã‚¹ãƒˆ
            const testCases = [
                { bytes: 0, expected: '0 Bytes' },
                { bytes: 512, expected: '512 Bytes' },
                { bytes: 1024, expected: '1 KB' },
                { bytes: 1048576, expected: '1 MB' },
                { bytes: 1073741824, expected: '1 GB' }
            ];

            for (const testCase of testCases) {
                const result = formatFileSize(testCase.bytes);
                runner.assertTrue(result.includes(testCase.expected) || 
                                result.startsWith(testCase.expected.split(' ')[0]),
                                `ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º ${testCase.bytes} bytes ãŒæ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹`);
            }
        });

        // ==================== ç‰¹æ®Šæ–‡å­—ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ====================
        runner.test('ç‰¹æ®Šæ–‡å­—å‡¦ç†', 'æ—¥æœ¬èªæ–‡å­—ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
é¨å£«å›£é•·æ®ºã—,æ‘ä¸Šæ˜¥æ¨¹,2017,978-4-10-108805-5`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    runner.assertEqual(results.data[0]['ã‚¿ã‚¤ãƒˆãƒ«'], 'ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®', 'æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹');
                    runner.assertEqual(results.data[1]['è‘—è€…'], 'æ‘ä¸Šæ˜¥æ¨¹', 'æ—¥æœ¬èªè‘—è€…åãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹');
                }
            });
        });

        runner.test('ç‰¹æ®Šæ–‡å­—å‡¦ç†', 'ã‚«ãƒ³ãƒã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ï¼ˆå¼•ç”¨ç¬¦ã§å›²ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼‰', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
"ã‚¿ã‚¤ãƒˆãƒ«, ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«",æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    runner.assertEqual(results.data[0]['ã‚¿ã‚¤ãƒˆãƒ«'].includes(','), true, 'ã‚«ãƒ³ãƒã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã¦ã„ã‚‹');
                }
            });
        });

        // ==================== ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ ====================
        runner.test('ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹', 'ã‚¹ãƒšãƒ¼ã‚¹ã®ã¿ã®ã‚»ãƒ«ã¯ç„¡è¦–ã•ã‚Œã‚‹', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
   ,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8`;

            Papa.parse(csvText, {
                header: true,
                complete: function(results) {
                    const title = results.data[0]['ã‚¿ã‚¤ãƒˆãƒ«'];
                    // ã‚¹ãƒšãƒ¼ã‚¹ã®ã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
                    runner.assertTrue(!title || title.trim() === '', 'ã‚¹ãƒšãƒ¼ã‚¹ã®ã¿ã®ã‚»ãƒ«ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã¦ã„ã‚‹');
                }
            });
        });

        runner.test('ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹', 'é‡è¤‡è¡ŒãŒå­˜åœ¨ã—ã¦ã‚‚å‡¦ç†ã§ãã‚‹', function() {
            const csvText = `ã‚¿ã‚¤ãƒˆãƒ«,è‘—è€…,ç™ºè¡Œå¹´,ISBNã‚³ãƒ¼ãƒ‰
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
ãƒãƒ«ã‚¦ã‚§ã‚¤ã®æ£®,æ‘ä¸Šæ˜¥æ¨¹,1987,978-4-06-182009-8
1Q84,æ‘ä¸Šæ˜¥æ¨¹,2009,978-4-10-108583-2`;

            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    runner.assertTrue(results.data.length === 3, 'é‡è¤‡è¡Œã‚’å«ã‚€CSVãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹');
                }
            });
        });

        // ==================== å®Ÿè¡Œé–¢æ•° ====================
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        async function runAllTests() {
            await runner.run();
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html>
